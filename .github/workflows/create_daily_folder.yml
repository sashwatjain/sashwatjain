name: Create Daily DSA Folder


on:
  schedule:
    - cron: "30 18 * * *"   # Daily at 12 AM IST
  workflow_dispatch:

jobs:
  create-dsa-folder:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main

      - name: Compute next DSA folder
        id: compute
        run: |
          set -e

          DSA_DIR="dsa"
          TEMPLATE_DIR="templates"

          mkdir -p "$DSA_DIR"

          last_day=0

          # Detect highest day folder (handles leading zeros correctly)
          for d in "$DSA_DIR"/day_*; do
            if [ -d "$d" ]; then
              num="${d##*_}"        # extract "08"
              num=$((10#$num))      # convert safe from octal â†’ decimal
              (( num > last_day )) && last_day=$num
            fi
          done

          next_day=$((last_day + 1))
          printf -v next_padded "%02d" "$next_day"

          new_folder="$DSA_DIR/day_$next_padded"
          mkdir -p "$new_folder"

          cp "$TEMPLATE_DIR/solution.py" "$new_folder/solution.py"
          cp "$TEMPLATE_DIR/problem.md" "$new_folder/problem.md"

          echo "Created folder: $new_folder"
          echo "new_folder=$new_folder" >> $GITHUB_OUTPUT

      - name: Commit & push changes
        run: |
          git pull --rebase origin main

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add dsa/

          NEW_FOLDER="${{ steps.compute.outputs.new_folder }}"

          git commit -m "Added $NEW_FOLDER" || {
            echo "No new folder created. Nothing to commit."
            exit 0
          }

          git push origin main
